@page "/dashboard-page"
@inherits LayoutComponentBase
@using Jamper_Financial.Shared.Data
@using Jamper_Financial.Shared.Services
@using Jamper_Financial.Shared.Models
@inject NavigationManager Navigation
@inject IUserService UserService
@inject LoginStateService LoginState
@inject UserStateService UserStateService


@code {
    [CascadingParameter] private Action<string> SetPageTitle { get; set; }

    private UserProfile userProfile = new UserProfile();
    private int currentIndex = 0;
    private List<string> cards = new List<string> { "History", "Recent Transactions", "Manage Saving Goals" };

    protected override async Task OnInitializedAsync()
    {
        SetPageTitle("Dashboard");



        // Get the logged-in user's ID and username from the UserStateService
        int userId = UserStateService.UserId;
        string username = UserStateService.Username;

        Console.WriteLine(userId);

        if (userId > 0)
        {
            userProfile = await UserService.GetUserProfileByIdAsync(userId);
        }
        else
        {
            Navigation.NavigateTo("/login");
        }
    }

    private void NextCard()
    {
        currentIndex = (currentIndex + 1) % cards.Count;
    }

    private void NavigateToSavingGoals()
    {
        Navigation.NavigateTo("/view-goals-page");
    }
}

<div class="dashboard-container">
    <div class="dashboard-header">
        <h3>Welcome back to JAMPER Finance!</h3>
    </div>

    <!-- Carousel Section -->
    <div class="carousel">
        <div class="card">
            <h3 class="@(cards[currentIndex] == "Manage Saving Goals" ? "manage-saving-goals-header" : "")" 
                @onclick="@(() => { if (cards[currentIndex] == "Manage Saving Goals") NavigateToSavingGoals(); })">
                @cards[currentIndex]
            </h3>
        </div>
        <div class="card">
            <h3 class="@(cards[(currentIndex + 1) % cards.Count] == "Manage Saving Goals" ? "manage-saving-goals-header" : "")" 
                @onclick="@(() => { if (cards[(currentIndex + 1) % cards.Count] == "Manage Saving Goals") NavigateToSavingGoals(); })">
                @cards[(currentIndex + 1) % cards.Count]
            </h3>
        </div>
        <button class="carousel-button" @onclick="NextCard">&#10095;</button>
    </div>

    <!-- Weekly Activity Section -->
    <div class="weekly-activity">
        <h4>Weekly Activity</h4>
        <div class="card">Placeholder for weekly activities...</div>
    </div>
</div>